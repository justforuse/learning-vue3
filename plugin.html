<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>插件的使用 | Vue3.0学习教程与实战案例</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="https://chengpeiquan.com/favicon.ico">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="这是一个关于Vue 3.0 + TypeScript的起步学习教程，适合完全的Vue新手和Vue 2.0的老手，在官方文档的基础上融入自己的一些实践经验。">
    <meta name="keywords" content="vue 3.0, vue 3.x, vue 3.0 教程, 学习 vue 3.0, vue 3.0 案例, vue 3.0 教学, vue 3.0 好用吗">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="https://cdn.jsdelivr.net/gh/chengpeiquan/learning-vue3@gh-pages/assets/css/0.styles.453b8680.css" as="style"><link rel="preload" href="https://cdn.jsdelivr.net/gh/chengpeiquan/learning-vue3@gh-pages/assets/js/app.2746b540.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/chengpeiquan/learning-vue3@gh-pages/assets/js/2.0e621934.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/chengpeiquan/learning-vue3@gh-pages/assets/js/16.927dc1e2.js" as="script"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/chengpeiquan/learning-vue3@gh-pages/assets/js/10.e838149d.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/chengpeiquan/learning-vue3@gh-pages/assets/js/11.8cb94aa4.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/chengpeiquan/learning-vue3@gh-pages/assets/js/12.d30f77f9.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/chengpeiquan/learning-vue3@gh-pages/assets/js/13.e30f1db3.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/chengpeiquan/learning-vue3@gh-pages/assets/js/14.b614dd79.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/chengpeiquan/learning-vue3@gh-pages/assets/js/15.d56eadb5.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/chengpeiquan/learning-vue3@gh-pages/assets/js/17.1b8d18c5.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/chengpeiquan/learning-vue3@gh-pages/assets/js/18.d2c28c9d.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/chengpeiquan/learning-vue3@gh-pages/assets/js/3.eb68ee27.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/chengpeiquan/learning-vue3@gh-pages/assets/js/4.05a23575.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/chengpeiquan/learning-vue3@gh-pages/assets/js/5.e9c7df82.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/chengpeiquan/learning-vue3@gh-pages/assets/js/6.6ced4ef9.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/chengpeiquan/learning-vue3@gh-pages/assets/js/7.bc6999b2.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/chengpeiquan/learning-vue3@gh-pages/assets/js/8.c90cdf29.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/chengpeiquan/learning-vue3@gh-pages/assets/js/9.602ff498.js">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/chengpeiquan/learning-vue3@gh-pages/assets/css/0.styles.453b8680.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Vue3.0学习教程与实战案例</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://chengpeiquan.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客首页
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/chengpeiquan/learning-vue3" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://chengpeiquan.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客首页
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/chengpeiquan/learning-vue3" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">前言</a></li><li><a href="/update.html" class="sidebar-link">升级与配置</a></li><li><a href="/component.html" class="sidebar-link">单组件的编写</a></li><li><a href="/router.html" class="sidebar-link">路由的使用</a></li><li><a href="/plugin.html" aria-current="page" class="active sidebar-link">插件的使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/plugin.html#关于插件" class="sidebar-link">关于插件</a></li><li class="sidebar-sub-header"><a href="/plugin.html#插件的安装和引入" class="sidebar-link">插件的安装和引入</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/plugin.html#通过-npm-安装" class="sidebar-link">通过 NPM 安装</a></li><li class="sidebar-sub-header"><a href="/plugin.html#通过-cnpm-安装" class="sidebar-link">通过 CNPM 安装</a></li><li class="sidebar-sub-header"><a href="/plugin.html#通过-yarn-安装" class="sidebar-link">通过 YARN 安装</a></li><li class="sidebar-sub-header"><a href="/plugin.html#通过-cdn-安装" class="sidebar-link">通过 CDN 安装</a></li><li class="sidebar-sub-header"><a href="/plugin.html#插件的引入" class="sidebar-link">插件的引入</a></li></ul></li><li class="sidebar-sub-header"><a href="/plugin.html#vue-专属插件" class="sidebar-link">Vue 专属插件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/plugin.html#全局插件的使用-new" class="sidebar-link">全局插件的使用{new}</a></li><li class="sidebar-sub-header"><a href="/plugin.html#单组件插件的使用-new" class="sidebar-link">单组件插件的使用{new}</a></li></ul></li><li class="sidebar-sub-header"><a href="/plugin.html#通用-js-插件" class="sidebar-link">通用 JS 插件</a></li><li class="sidebar-sub-header"><a href="/plugin.html#本地的一些工具插件" class="sidebar-link">本地的一些工具插件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/plugin.html#为什么要封装本地插件" class="sidebar-link">为什么要封装本地插件</a></li><li class="sidebar-sub-header"><a href="/plugin.html#如何封装一个本地插件" class="sidebar-link">如何封装一个本地插件</a></li></ul></li><li class="sidebar-sub-header"><a href="/plugin.html#全局-api-挂载" class="sidebar-link">全局 API 挂载</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/plugin.html#回顾-2-x" class="sidebar-link">回顾 2.x</a></li><li class="sidebar-sub-header"><a href="/plugin.html#了解-3-x-new" class="sidebar-link">了解 3.x{new}</a></li><li class="sidebar-sub-header"><a href="/plugin.html#定义全局-api-new" class="sidebar-link">定义全局 API{new}</a></li><li class="sidebar-sub-header"><a href="/plugin.html#使用全局-api-new" class="sidebar-link">使用全局 API{new}</a></li><li class="sidebar-sub-header"><a href="/plugin.html#全局-api-的替代方案" class="sidebar-link">全局 API 的替代方案</a></li></ul></li><li class="sidebar-sub-header"><a href="/plugin.html#本节结语" class="sidebar-link">本节结语</a></li></ul></li><li><a href="/communication.html" class="sidebar-link">组件之间的通信</a></li><li><a href="/efficient.html" class="sidebar-link">高效开发</a></li><li><a href="/links.html" class="sidebar-link">拓展阅读</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="插件的使用"><a href="#插件的使用" class="header-anchor">#</a> 插件的使用</h1> <p>在构建 Vue 项目的过程中，离不开各种开箱即用的插件支持，用以快速完成需求，避免自己造轮子。</p> <h2 id="关于插件"><a href="#关于插件" class="header-anchor">#</a> 关于插件</h2> <p>关于插件的定义，摘选一段 <a href="https://v3.vuejs.org/guide/plugins.html" target="_blank" rel="noopener noreferrer">官方plugins文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的描述：</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>插件是自包含的代码，通常向 Vue 添加全局级功能。它可以是一个带有公开 <code>install()</code> 方法的 <code>object</code>，也可以是 一个<code>function</code></p> <p>插件的功能范围没有严格的限制，一般有下面几种：</p> <p>添加全局方法或者 <code>property</code>。如：<a href="https://github.com/karol-f/vue-custom-element" target="_blank" rel="noopener noreferrer">vue-custom-element<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>添加全局资源：指令/过滤器/过渡等，例如：<a href="https://github.com/vuejs/vue-touch" target="_blank" rel="noopener noreferrer">vue-touch<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>通过全局混入来添加一些组件选项，例如：<a href="https://github.com/vuejs/vue-router" target="_blank" rel="noopener noreferrer">vue-router<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>添加全局实例方法，通过把它们添加到 <code>config.globalProperties</code> 上实现。</p> <p>一个库，提供自己的 API，同时提供上面提到的一个或多个功能。如 <a href="https://github.com/vuejs/vue-router" target="_blank" rel="noopener noreferrer">vue-router<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <p>不同的实现方法，也会有不同的使用方式，下面按照使用方式的不同，把插件按照三类划分，单独讲解他们之间的区别和如何使用。</p> <h2 id="插件的安装和引入"><a href="#插件的安装和引入" class="header-anchor">#</a> 插件的安装和引入</h2> <p>我们的脚手架都是基于 <code>Node.js</code>，所以提供了多种多样的安装方式。</p> <h3 id="通过-npm-安装"><a href="#通过-npm-安装" class="header-anchor">#</a> 通过 NPM 安装</h3> <p>NPM 是 <code>Node.js</code> 自带的一个包管理工具，在前端工程化十分普及的今天，可以说几乎所有你要用到的插件，都可以在npm上搜到。</p> <p>通过 <code>npm install</code> 命令来安装各种npm包（比如 <code>npm install vue-router</code>）。</p> <p>附：<a href="https://www.npmjs.com/" target="_blank" rel="noopener noreferrer">NPM 官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>NPM 在国内访问速度会比较慢，建议有梯子的用户使用。</p> <p>我自己在用的是 <a href="https://shadow-flys.us/auth/register?code=iSGi" target="_blank" rel="noopener noreferrer">Shadowfly<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，目前已经稳定用了有2年+ 。</p></div> <h3 id="通过-cnpm-安装"><a href="#通过-cnpm-安装" class="header-anchor">#</a> 通过 CNPM 安装</h3> <p>由于一些不可描述的原因， NPM 在国内可能访问速度比较慢，你可以通过绑定淘宝镜像，通过 CNPM 源来下载包，CNPM 是完全同步 NPM 的。</p> <p>它的安装命令和 NPM 非常一致，通过 <code>cnpm install</code> 命令来安装（比如 <code>cnpm install vue-router</code>）。</p> <p>在使用它之前，你需要通过 NPM 命令将其绑定到你的 <code>node</code> 上。</p> <div class="language- extra-class"><pre class="language-text"><code>npm install -g cnpm --registry=https://registry.npm.taobao.org
</code></pre></div><p>附：<a href="https://developer.aliyun.com/mirror/NPM" target="_blank" rel="noopener noreferrer">CNPM 官网与绑定教程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="通过-yarn-安装"><a href="#通过-yarn-安装" class="header-anchor">#</a> 通过 YARN 安装</h3> <p>YARN 也是一个常用的包管理工具，和 NPM 十分相似，NPM 上的包，也会同步到 YARN ，通过 <code>yarn add</code> 命令来安装即可（比如 <code>yarn add vue-router</code>）。</p> <p>如果你没有日常翻墙，也可以考虑用 YARN 来代替 NPM，当然，在使用之前，你也必须先安装它才可以，一般情况下，需要添加 <code>-g</code> 或者 <code>--global</code> 参数来全局安装。</p> <div class="language- extra-class"><pre class="language-text"><code>npm install -g yarn
</code></pre></div><p>附：<a href="https://yarnpkg.com/" target="_blank" rel="noopener noreferrer">YARN 官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>不知道选择哪个？可以戳：<a href="https://www.jianshu.com/p/254794d5e741" target="_blank" rel="noopener noreferrer">npm和yarn的区别，我们该如何选择?<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="通过-cdn-安装"><a href="#通过-cdn-安装" class="header-anchor">#</a> 通过 CDN 安装</h3> <p>大部分插件都会提供一个 CDN 版本，让你可以在 <code>html</code> 通过 <code>script</code> 标签引入。</p> <p>比如：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://unpkg.com/vue-router<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="插件的引入"><a href="#插件的引入" class="header-anchor">#</a> 插件的引入</h3> <p>除了 CDN 版本是直接可用之外，其他通过 NPM、YARN 等方式安装的插件，都需要在入口文件 <code>main.js</code> 或者要用到的 <code>.vue</code> 文件里引入，比如：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createRouter<span class="token punctuation">,</span> createWebHistory<span class="token punctuation">,</span> RouteRecordRaw <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue-router'</span>
</code></pre></div><p>因为本教程都是基于工程化开发，使用的 CLI 脚手架，所以这些内容暂时不谈及 CDN 的使用方式。</p> <p>通常来说会有细微差别，但影响不大，插件作者也会在插件仓库的 README 或者使用文档里进行告知。</p> <h2 id="vue-专属插件"><a href="#vue-专属插件" class="header-anchor">#</a> Vue 专属插件</h2> <p>这里特指 Vue 插件，通过 <a href="https://v3.cn.vuejs.org/guide/plugins.html" target="_blank" rel="noopener noreferrer">Vue Plugins 设计规范<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 开发出来的插件，在npm上通常是以 <code>vue-xxx</code> 这样带有 vue 关键字的格式命名（比如 <a href="https://github.com/chengpeiquan/vue-baidu-analytics" target="_blank" rel="noopener noreferrer">vue-baidu-analytics<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>）。</p> <p>专属插件通常分为 <strong>全局插件</strong> 和 <strong>单组件插件</strong>，区别在于，全局版本是在 <code>main.ts</code> 引入后 <code>use</code>，而单组件版本则通常是作为一个组件在 <code>.vue</code> 文件里引入使用。</p> <h3 id="全局插件的使用-new"><a href="#全局插件的使用-new" class="header-anchor">#</a> 全局插件的使用{new}</h3> <p>在本教程最最前面的时候，我有特地说了一个内容就是 <a href="/update.html#项目初始化">项目初始化 - 升级与配置</a> ，在这里有提到过就是需要通过 <code>use</code> 来初始化框架、插件。</p> <p>全局插件的使用，就是在 <code>main.ts</code> 通过 <code>import</code> 引入，然后通过 <code>use</code> 来启动初始化。</p> <p>在 2.x ，全局插件是通过 <code>Vue.use(xxxxxx)</code> 来启动，而现在，则需要通过 <code>createApp</code> 的 <code>use</code>，<code>use</code> 方法，既可以单独一行一个 use ，也可以直接链式 use 下去。</p> <p><strong>参数</strong></p> <p><code>use</code> 方法支持两个参数：</p> <table><thead><tr><th style="text-align:left;">参数</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">作用</th></tr></thead> <tbody><tr><td style="text-align:left;">plugin</td> <td style="text-align:left;">object | function</td> <td style="text-align:left;">插件，一般是你在 import 时使用的名称</td></tr> <tr><td style="text-align:left;">options</td> <td style="text-align:left;">object</td> <td style="text-align:left;">插件的参数，有些插件在初始化时可以配置一定的选项</td></tr></tbody></table> <p>基本的写法就是像下面这样：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// main.ts</span>
<span class="token keyword">import</span> plugin1 <span class="token keyword">from</span> <span class="token string">'plugin1'</span>
<span class="token keyword">import</span> plugin2 <span class="token keyword">from</span> <span class="token string">'plugin2'</span>
<span class="token keyword">import</span> plugin3 <span class="token keyword">from</span> <span class="token string">'plugin3'</span>
<span class="token keyword">import</span> plugin4 <span class="token keyword">from</span> <span class="token string">'plugin4'</span>

<span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>plugin1<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>plugin2<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>plugin3<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">// plugin3's options</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>plugin4<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
</code></pre></div><p>大部分插件到这里就可以直接启动了，个别插件可能需要通过插件 API 去手动触发，在 <code>npm package</code> 的详情页上，作者一般会告知使用方法，按照说明书操作即可。</p> <h3 id="单组件插件的使用-new"><a href="#单组件插件的使用-new" class="header-anchor">#</a> 单组件插件的使用{new}</h3> <p>单组件的插件，通常自己本身也是一个 Vue 组件（大部分情况下都会打包为 JS 文件，但本质上是一个 Vue 的 component ）。</p> <p>单组件的引入，一般都是在需要用到的 <code>.vue</code> 文件里单独 <code>import</code> ，然后挂到 <code>template</code> 里去渲染。</p> <p>我放一个我之前打包的单组件插件 <a href="https://github.com/chengpeiquan/vue-picture-cropper" target="_blank" rel="noopener noreferrer">vue-picture-cropper<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 做案例，理解起来会比较直观：</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 放置组件的渲染标签，用于显示组件 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vue-picture-cropper</span>
    <span class="token attr-name">:boxStyle</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{
      width: <span class="token punctuation">'</span>100%<span class="token punctuation">'</span>,
      height: <span class="token punctuation">'</span>100%<span class="token punctuation">'</span>,
      backgroundColor: <span class="token punctuation">'</span>#f8f8f8<span class="token punctuation">'</span>,
      margin: <span class="token punctuation">'</span>auto<span class="token punctuation">'</span>
    }<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">:img</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pic<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">:options</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{
      viewMode: 1,
      dragMode: <span class="token punctuation">'</span>crop<span class="token punctuation">'</span>,
      aspectRatio: 16 / 9,
    }<span class="token punctuation">&quot;</span></span>
  <span class="token punctuation">/&gt;</span></span>
  <span class="token comment">&lt;!-- 放置组件的渲染标签，用于显示组件 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ts<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> onMounted<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token comment">// 引入单组件插件</span>
<span class="token keyword">import</span> VuePictureCropper<span class="token punctuation">,</span> <span class="token punctuation">{</span> cropper <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue-picture-cropper'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// 挂载组件模板</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span>
    VuePictureCropper
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// 在这里定义一些组件需要用到的数据和函数</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> pic <span class="token operator">=</span> ref<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">onMounted</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      pic<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@/assets/logo.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      pic
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>哈哈哈哈参考上面的代码，还有注释，应该能大概了解如何使用单组件插件了吧！</p> <h2 id="通用-js-插件"><a href="#通用-js-插件" class="header-anchor">#</a> 通用 JS 插件</h2> <p>也叫普通插件，这个 “普通” 不是指功能平平无奇，而是指它们无需任何框架依赖，可以应用在任意项目中，属于独立的 JS Library ，比如 <a href="https://github.com/axios/axios" target="_blank" rel="noopener noreferrer">axios<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 、 <a href="https://github.com/soldair/node-qrcode" target="_blank" rel="noopener noreferrer">qrcode<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 、<a href="https://github.com/pvorb/node-md5" target="_blank" rel="noopener noreferrer">md5<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 等等，在任何技术栈都可以单独引入使用，非 Vue 专属。</p> <p>通用 JS 插件的使用非常灵活，既可以全局挂载，也可以在需要用到的组件里单独引入。</p> <p>组件里单独引入方式：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> md5 <span class="token keyword">from</span> <span class="token string">'md5'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token constant">MD5_MSG</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>全局挂载方法比较特殊，因为插件本身不是专属 Vue，没有 <code>install</code> 接口，无法通过 <code>use</code> 方法直接启动，下面有一 part 单独讲这一块的操作，详见 <a href="#%E5%85%A8%E5%B1%80-api-%E6%8C%82%E8%BD%BD">全局 API 挂载</a>。</p> <h2 id="本地的一些工具插件"><a href="#本地的一些工具插件" class="header-anchor">#</a> 本地的一些工具插件</h2> <p>插件也不全是来自于网上，有时候针对自己的业务，涉及到一些经常用到的功能模块，你也可以抽离出来封装成项目专用的本地插件。</p> <h3 id="为什么要封装本地插件"><a href="#为什么要封装本地插件" class="header-anchor">#</a> 为什么要封装本地插件</h3> <p>举个例子，比如在做一个具备用户系统的网站时，会涉及到手机短信验证码模块，你在开始写代码之前，需要先要考虑到这些问题：</p> <ol><li><p>很多操作都涉及到下发验证码的请求，比如 “登录” 、 “注册” 、 “修改手机绑定” 、 “支付验证” 等等，代码雷同，只是接口 URL 或者参数不太一样</p></li> <li><p>都是需要对手机号是否有传入、手机号的格式正确性验证等一些判断</p></li> <li><p>需要对接口请求成功和失败的情况做一些不同的数据返回，但要处理的数据很相似，都是用于告知调用方当前是什么情况</p></li> <li><p>返回一些 Toast 告知用户当前的交互结果</p></li></ol> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果不把这一块的业务代码抽离出来，你需要在每个用到的地方都写一次，不仅繁琐，而且以后一旦产品需求有改动，维护起来就惨了。</p></div> <h3 id="如何封装一个本地插件"><a href="#如何封装一个本地插件" class="header-anchor">#</a> 如何封装一个本地插件</h3> <p>一般情况下，都是封装成一个 JS Library，或者一个 Vue Component 单组件插件就可以了。</p> <p>我以上面提到的获取手机短信验证码模块为例子，我当时是这么处理的，把判断、请求、结果返回、Toast 都抽离出来，将其封装成一个 <code>getVerCode.ts</code> 放到 <code>src/libs</code> 目录下：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'@libs/axios'</span>
<span class="token keyword">import</span> message <span class="token keyword">from</span> <span class="token string">'@libs/message'</span>
<span class="token keyword">import</span> regexp <span class="token keyword">from</span> <span class="token string">'@libs/regexp'</span>

<span class="token comment">/** 
 * 获取验证码
 * @param phoneNumber - 手机号
 * @param mode - 获取模式：login=登录，reg=注册
 * @param params - 请求的参数
 * @return verCode - 验证码：success=验证码内容，error=空值
 */</span>
<span class="token keyword">const</span> getVerCode <span class="token operator">=</span> <span class="token punctuation">(</span>
  phoneNumber<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  params<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span> <span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">let</span> apiUrl <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>

    <span class="token comment">/** 
     * 校验参数
     */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span>phoneNumber <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'请输入手机号'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span>regexp<span class="token punctuation">.</span><span class="token function">isMob</span><span class="token punctuation">(</span>phoneNumber<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'手机号格式不正确'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span>mode <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'验证码获取模式未传入'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/** 
     * 判断当前是请求哪种验证码
     */</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>mode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">'login'</span><span class="token operator">:</span>
        apiUrl <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/sms/login/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>phoneNumber<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">'reg'</span><span class="token operator">:</span>
        apiUrl <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/sms/register/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>phoneNumber<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">'rebind'</span><span class="token operator">:</span>
        apiUrl <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/sms/authentication/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>phoneNumber<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">default</span><span class="token operator">:</span>
        message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'验证码获取模式传入错误'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">/** 
     * 请求验证码
     */</span>
    <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      isNoToken<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      isNoRefresh<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      method<span class="token operator">:</span> <span class="token string">'get'</span><span class="token punctuation">,</span>
      url<span class="token operator">:</span> apiUrl<span class="token punctuation">,</span>
      params<span class="token operator">:</span> params
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

      <span class="token comment">// 异常拦截</span>
      <span class="token keyword">const</span> <span class="token constant">CODE</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> data<span class="token punctuation">.</span>code <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token constant">MSG</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> data<span class="token punctuation">.</span>msg <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token constant">CODE</span> <span class="token operator">!==</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token constant">MSG</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token constant">MSG</span> <span class="token operator">===</span> <span class="token string">'验证码发送过频繁'</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'频繁'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 返回验证码成功标识</span>
      message<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">'验证码已发送，请查收手机短信'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token constant">RESULT</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> data<span class="token punctuation">.</span>msg <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">;</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token constant">RESULT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span> <span class="token punctuation">(</span>err<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'网络异常，获取验证码失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> getVerCode<span class="token punctuation">;</span>
</code></pre></div><p>然后你在需要用到的 <code>.vue</code> 组件里，就可以这样去获取验证码了，一句代码走天下：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 导入验证码插件</span>
<span class="token keyword">import</span> getVerCode <span class="token keyword">from</span> <span class="token string">'@libs/getVerCode'</span>

<span class="token comment">// 获取登录验证码</span>
<span class="token function">getVerCode</span><span class="token punctuation">(</span><span class="token number">13800138000</span><span class="token punctuation">,</span> <span class="token string">'login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 获取注册验证码</span>
<span class="token function">getVerCode</span><span class="token punctuation">(</span><span class="token number">13800138000</span><span class="token punctuation">,</span> <span class="token string">'reg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>因为是 <code>Promise</code> ，如果还需要做一些别的回调操作，还可以使用 <code>async / await</code> 或者 <code>then / catch</code> 去处理。</p> <h2 id="全局-api-挂载"><a href="#全局-api-挂载" class="header-anchor">#</a> 全局 API 挂载</h2> <p>对于一些使用频率比较高的插件方法，如果你觉得在每个组件里单独导入再用很麻烦，你也可以考虑将其挂载到 Vue 上，使其成为 Vue 的全局变量。</p> <p><strong>注：接下来的全局变量，都是指 Vue 环境里的全局变量，非 Window 下的全局变量。</strong></p> <h3 id="回顾-2-x"><a href="#回顾-2-x" class="header-anchor">#</a> 回顾 2.x</h3> <p>在 2.x ，可以通过 <code>prototype</code> 的方式来挂载全局变量，然后通过 <code>this</code> 关键字来从 Vue 原型上调用该方法。</p> <p>我以 <code>md5</code> 插件为例，在 <code>main.ts</code> 里进行全局 <code>import</code>，然后通过 <code>prototype</code> 去挂到 Vue 上。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> md5 <span class="token keyword">from</span> <span class="token string">'md5'</span>

Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$md5 <span class="token operator">=</span> md5<span class="token punctuation">;</span>
</code></pre></div><p>之后在 <code>.vue</code> 文件里，你就可以这样去使用 <code>md5</code>。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> <span class="token constant">MD5_MSG</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$md5</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="了解-3-x-new"><a href="#了解-3-x-new" class="header-anchor">#</a> 了解 3.x{new}</h3> <p>在 3.x ，已经不再支持 <code>prototype</code> 这样使用了，在 <code>main.ts</code> 里没有了 <code>Vue</code>，在组件的生命周期里也没有了 <code>this</code>。</p> <p>如果你依然想要挂载全局变量，需要通过全新的 <a href="https://v3.cn.vuejs.org/api/application-config.html#globalproperties" target="_blank" rel="noopener noreferrer">globalProperties<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来实现，在使用该方式之前，可以把 <code>createApp</code> 定义为一个变量再执行挂载。</p> <h3 id="定义全局-api-new"><a href="#定义全局-api-new" class="header-anchor">#</a> 定义全局 API{new}</h3> <p>如上，在配置全局变量之前，你可以把初始化时的 <code>createApp</code> 定义为一个变量（假设为 <code>app</code> ），然后把需要设置为全局可用的变量或方法，挂载到 <code>app</code> 的 <code>config.globalProperties</code> 上面。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> md5 <span class="token keyword">from</span> <span class="token string">'md5'</span>

<span class="token comment">// 创建 Vue 实例</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>

<span class="token comment">// 把插件的 API 挂载全局变量到实例上</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>globalProperties<span class="token punctuation">.</span>$md5 <span class="token operator">=</span> md5<span class="token punctuation">;</span>

<span class="token comment">// 你也可以自己写一些全局函数去挂载</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>globalProperties<span class="token punctuation">.</span>$log <span class="token operator">=</span> <span class="token punctuation">(</span>text<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="使用全局-api-new"><a href="#使用全局-api-new" class="header-anchor">#</a> 使用全局 API{new}</h3> <p>要在 Vue 组件里使用，因为 3.x 的 <a href="/component.html#组件的生命周期-new">生命周期</a> 无法取得实例的 <code>this</code> 来操作，需要通过全新的 <a href="https://v3.cn.vuejs.org/api/composition-api.html#getcurrentinstance" target="_blank" rel="noopener noreferrer">getCurrentInstance<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 组件来进行处理。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 导入 getCurrentInstance 组件</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> getCurrentInstance <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取当前实例</span>
    <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">getCurrentInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 增加这层判断的原因见下方说明</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> app <span class="token punctuation">)</span> <span class="token punctuation">{</span>

      <span class="token comment">// 调用全局的 MD5 API 进行加密</span>
      <span class="token keyword">const</span> <span class="token constant">MD5_STR</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> app<span class="token punctuation">.</span>appContext<span class="token punctuation">.</span>config<span class="token punctuation">.</span>globalProperties<span class="token punctuation">.</span><span class="token function">$md5</span><span class="token punctuation">(</span><span class="token string">'Hello World!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">MD5_STR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 调用刚刚挂载的打印函数</span>
      app<span class="token punctuation">.</span>appContext<span class="token punctuation">.</span>config<span class="token punctuation">.</span>globalProperties<span class="token punctuation">.</span><span class="token function">$log</span><span class="token punctuation">(</span><span class="token string">'Hello World!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>由于使用了 <a href="/component.html#了解-definecomponent">defineComponent</a> ，它会帮我们自动推导 <code>getCurrentInstance()</code> 的类型为 <code>ComponentInternalInstance</code> 或 <code>null</code> 。</p> <p>所以如果你的项目下的 TS 开启了 <code>--strictNullChecks</code> 选项，需要对实例变量做一层判断才能正确运行程序（可参考 <a href="/component.html#dom-元素与子组件">DOM 元素与子组件</a> 一节）。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>需要注意的是， <code>getCurrentInstance</code> 只能在 <a href="/component.html#全新的-setup-函数-new">setup</a> 函数或者 Vue 3.0 的 <a href="/component.html#组件的生命周期-new">生命周期</a> 钩子中调用。</p> <p>如需在 <code>setup</code> 或生命周期钩子外使用，需要先在 <code>setup</code> 中调用 <code>const app = getCurrentInstance();</code> 获取实例变量，然后再通过 <code>app</code> 变量去使用。</p></div> <h3 id="全局-api-的替代方案"><a href="#全局-api-的替代方案" class="header-anchor">#</a> 全局 API 的替代方案</h3> <p>在 Vue 3.x 实际上并不是特别推荐使用全局变量，3.x 比较推荐按需引入使用（从使用方式上也可以看得出，这类全局 API 的用法还真的挺麻烦的…）。</p> <p>特别是针对 TypeScript ，尤大对于全局 API 的相关 PR 说明： <a href="https://github.com/vuejs/rfcs/pull/117" target="_blank" rel="noopener noreferrer">Global API updates<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，也是不建议在 TS 里使用。</p> <p>那么确实是需要用到一些全局 API 怎么办？</p> <p>对于一般的数据和方法，建议采用 <a href="/communication.html#provide-inject">provide / inject</a> 方案，在根组件（通常是 App.vue ）把需要作为全局使用的数据 / 方法 provide 下去，在需要用到的组件里通过 inject 即可获取到，或者使用 <a href="/communication.html#eventbus-new">EventBus</a> 和 <a href="/communication.html#vuex-new">Vuex</a> 等全局通信方案来处理。</p> <h2 id="本节结语"><a href="#本节结语" class="header-anchor">#</a> 本节结语</h2> <p>插件的使用基本上就涉及到这些点了，很多同学之所以还不敢在业务中使用 Vue 3.0，应该也是顾虑于 3.0 是不是有很多插件不能用，影响业务的开发效率（之前有问过不同公司的一些朋友，大部分都是出于这个考虑）。</p> <p>相信经过这一章的说明，心里应该有底了，在缺少针对性的 Vue 专属插件的情况下，不妨也试一下通用的原生 JS Library 。</p> <!----> <!----></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/chengpeiquan/learning-vue3/edit/main/docs/plugin.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/5/2021, 4:43:28 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/router.html" class="prev">
        路由的使用
      </a></span> <span class="next"><a href="/communication.html">
        组件之间的通信
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="https://cdn.jsdelivr.net/gh/chengpeiquan/learning-vue3@gh-pages/assets/js/app.2746b540.js" defer></script><script src="https://cdn.jsdelivr.net/gh/chengpeiquan/learning-vue3@gh-pages/assets/js/2.0e621934.js" defer></script><script src="https://cdn.jsdelivr.net/gh/chengpeiquan/learning-vue3@gh-pages/assets/js/16.927dc1e2.js" defer></script>
  </body>
</html>
